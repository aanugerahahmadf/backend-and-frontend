(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,54858,e=>{"use strict";let t="http://127.0.0.1:8000/api/v1",s=async(e,t={})=>{try{let s=await fetch(e,{headers:{"Content-Type":"application/json",...t.headers},...t});if(!s.ok)throw Error(`HTTP error! status: ${s.status}`);return await s.json()}catch(t){throw console.error(`API request failed: ${e}`,t),t}};e.s(["api",0,{getStats:async()=>s(`${t}/stats`),getBuildings:async()=>s(`${t}/buildings`),getBuilding:async e=>s(`${t}/buildings/${e}`),getRooms:async()=>s(`${t}/rooms`),getRoomsByBuilding:async e=>s(`${t}/rooms/building/${e}`),getRoom:async e=>s(`${t}/rooms/${e}`),getCctvs:async()=>s(`${t}/cctvs`),getCctvsByRoom:async e=>s(`${t}/cctvs/room/${e}`),getCctv:async e=>s(`${t}/cctvs/${e}`),getCctvStreamUrl:async e=>s(`${t}/cctvs/${e}/stream-url`),getContacts:async()=>s(`${t}/contacts`)}])},78716,e=>{"use strict";let t=(0,e.i(75254).default)("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);e.s(["Video",()=>t],78716)},67585,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"BailoutToCSR",{enumerable:!0,get:function(){return r}});let l=e.r(32061);function r({reason:e,children:t}){if("undefined"==typeof window)throw Object.defineProperty(new l.BailoutToCSRError(e),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});return t}},9885,(e,t,s)=>{"use strict";function l(e){return e.split("/").map(e=>encodeURIComponent(e)).join("/")}Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"encodeURIPath",{enumerable:!0,get:function(){return l}})},52157,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"PreloadChunks",{enumerable:!0,get:function(){return i}});let l=e.r(43476),r=e.r(74080),a=e.r(63599),n=e.r(9885);function i({moduleIds:e}){if("undefined"!=typeof window)return null;let t=a.workAsyncStorage.getStore();if(void 0===t)return null;let s=[];if(t.reactLoadableManifest&&e){let l=t.reactLoadableManifest;for(let t of e){if(!l[t])continue;let e=l[t].files;s.push(...e)}}return 0===s.length?null:(0,l.jsx)(l.Fragment,{children:s.map(e=>{let s=`${t.assetPrefix}/_next/${(0,n.encodeURIPath)(e)}`;return e.endsWith(".css")?(0,l.jsx)("link",{precedence:"dynamic",href:s,rel:"stylesheet",as:"style",nonce:t.nonce},e):((0,r.preload)(s,{as:"script",fetchPriority:"low",nonce:t.nonce}),null)})})}},69093,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"default",{enumerable:!0,get:function(){return c}});let l=e.r(43476),r=e.r(71645),a=e.r(67585),n=e.r(52157);function i(e){return{default:e&&"default"in e?e.default:e}}let d={loader:()=>Promise.resolve(i(()=>null)),loading:null,ssr:!0},c=function(e){let t={...d,...e},s=(0,r.lazy)(()=>t.loader().then(i)),c=t.loading;function o(e){let i=c?(0,l.jsx)(c,{isLoading:!0,pastDelay:!0,error:null}):null,d=!t.ssr||!!t.loading,o=d?r.Suspense:r.Fragment,u=t.ssr?(0,l.jsxs)(l.Fragment,{children:["undefined"==typeof window?(0,l.jsx)(n.PreloadChunks,{moduleIds:t.modules}):null,(0,l.jsx)(s,{...e})]}):(0,l.jsx)(a.BailoutToCSR,{reason:"next/dynamic",children:(0,l.jsx)(s,{...e})});return(0,l.jsx)(o,{...d?{fallback:i}:{},children:u})}return o.displayName="LoadableComponent",o}},70703,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"default",{enumerable:!0,get:function(){return r}});let l=e.r(55682)._(e.r(69093));function r(e,t){let s={};"function"==typeof e&&(s.loader=e);let r={...s,...t};return(0,l.default)({...r,modules:r.loadableGenerated?.modules})}("function"==typeof s.default||"object"==typeof s.default&&null!==s.default)&&void 0===s.default.__esModule&&(Object.defineProperty(s.default,"__esModule",{value:!0}),Object.assign(s.default,s),t.exports=s.default)},50704,e=>{"use strict";var t=e.i(43476),s=e.i(71645),l=e.i(70703),r=e.i(78716),a=e.i(54858);let n=(0,l.default)(()=>e.A(52169).then(e=>e.MapContainer),{loadableGenerated:{modules:[94970]},ssr:!1,loading:()=>(0,t.jsx)("div",{className:"w-full h-full bg-gradient-to-br from-blue-950/30 to-slate-900/30 flex items-center justify-center",children:(0,t.jsx)("p",{className:"text-white/50 font-semibold",children:"Loading map..."})})}),i=(0,l.default)(()=>e.A(52169).then(e=>e.TileLayer),{loadableGenerated:{modules:[94970]},ssr:!1}),d=(0,l.default)(()=>e.A(52169).then(e=>e.Marker),{loadableGenerated:{modules:[94970]},ssr:!1}),c=(0,l.default)(()=>e.A(52169).then(e=>e.Popup),{loadableGenerated:{modules:[94970]},ssr:!1});function o(){let[e,l]=(0,s.useState)([]),[o,u]=(0,s.useState)(null),[m,x]=(0,s.useState)(!1),[h,f]=(0,s.useState)(null),[p,b]=(0,s.useState)(!0),[j,g]=(0,s.useState)(!1);(0,s.useRef)(null),(0,s.useEffect)(()=>{g(!0),v()},[]);let v=async()=>{try{let e=await a.api.getBuildings();l(e)}catch(e){console.error("Failed to fetch buildings:",e)}finally{b(!1)}},y=async e=>{try{u(e),x(!0);let t=await a.api.getCctvStreamUrl(e.id);f(t),console.log("Stream data:",t)}catch(e){console.error("Failed to fetch stream URL:",e)}};return(0,s.useEffect)(()=>{let e=e=>{"Escape"===e.key&&(x(!1),f(null))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]),(0,t.jsxs)("main",{className:"bg-gradient-to-br from-blue-950 via-slate-900 to-blue-950 py-8 min-h-[calc(100vh-140px)] flex flex-col",children:[(0,t.jsx)("div",{className:"pt-4 pb-6 px-4",children:(0,t.jsx)("h1",{className:"text-3xl md:text-4xl font-semibold text-white text-center",children:"Maps"})}),(0,t.jsx)("div",{className:"px-4 pb-6 flex-grow",children:(0,t.jsx)("div",{className:"h-[50vh] sm:h-[60vh] md:h-[70vh] w-full rounded-2xl overflow-hidden shadow-2xl z-0",children:j&&!p?(0,t.jsxs)(n,{center:[-6.1751,108.2146],zoom:13,style:{height:"100%",width:"100%"},className:"z-0",children:[(0,t.jsx)(i,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'}),e.map(e=>(0,t.jsx)(d,{position:[e.latitude,e.longitude],children:(0,t.jsx)(c,{children:(0,t.jsxs)("div",{className:"p-2 max-w-xs",children:[(0,t.jsx)("h3",{className:"font-bold text-lg",children:e.name}),(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:[e.rooms?.length||0," Rooms"]}),e.marker_icon_url&&(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)("img",{src:e.marker_icon_url,alt:"Building Marker",className:"w-8 h-8 inline-block mr-2"})}),(0,t.jsx)("div",{className:"mt-2 max-h-60 overflow-y-auto",children:e.rooms?.map(e=>(0,t.jsxs)("div",{className:"mb-2 p-2 border rounded",children:[(0,t.jsx)("h4",{className:"font-semibold",children:e.name}),(0,t.jsxs)("p",{className:"text-xs text-gray-600",children:[e.cctvs?.length||0," CCTVs"]}),e.marker_icon_url&&(0,t.jsx)("div",{className:"mt-1",children:(0,t.jsx)("img",{src:e.marker_icon_url,alt:"Room Marker",className:"w-6 h-6 inline-block mr-2"})}),(0,t.jsx)("div",{className:"mt-1",children:e.cctvs?.map(e=>(0,t.jsxs)("button",{onClick:()=>y(e),className:"mt-1 w-full bg-red-600 hover:bg-red-700 text-white text-xs font-semibold py-1 px-2 rounded flex items-center justify-center gap-1",children:[(0,t.jsx)(r.Video,{className:"w-3 h-3"}),"Live Stream"]},`cctv-${e.id}`))})]},`room-${e.id}`))})]})})},`building-${e.id}`))]}):(0,t.jsx)("div",{className:"w-full h-full bg-gradient-to-br from-blue-950/30 to-slate-900/30 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500 mb-3"}),(0,t.jsx)("p",{className:"text-white/50 font-semibold",children:"Loading map..."})]})})})}),(0,t.jsxs)("div",{className:"px-4 pb-6",children:[(0,t.jsx)("h2",{className:"text-2xl font-semibold text-white mb-4",children:"CCTV Camera"}),(0,t.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:e.flatMap(e=>e.rooms?.flatMap(s=>s.cctvs?.map(l=>(0,t.jsxs)("div",{className:"bg-blue-900/50 border border-white/10 rounded-xl p-4 hover:bg-blue-900/70 transition",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold text-white",children:l.name}),(0,t.jsxs)("p",{className:"text-sm text-white/70",children:[s.name," - ",e.name]})]}),(0,t.jsx)("button",{onClick:()=>y(l),className:"bg-red-600 hover:bg-red-700 text-white p-2 rounded-lg flex items-center justify-center",children:(0,t.jsx)(r.Video,{className:"w-4 h-4"})})]}),(0,t.jsxs)("div",{className:"mt-3 text-xs text-white/60",children:[(0,t.jsx)("p",{children:l.ip_address}),(0,t.jsx)("p",{children:l.status||"Active"})]})]},`grid-cctv-${l.id}`))))})]}),m&&o&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-blue-950 border border-white/20 rounded-2xl w-full max-w-2xl max-h-[90vh] flex flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 md:p-6 border-b border-white/10",children:[(0,t.jsxs)("h2",{className:"text-lg md:text-xl font-semibold text-white flex items-center gap-2",children:[(0,t.jsx)(r.Video,{className:"w-5 h-5 text-red-400"}),(0,t.jsx)("span",{className:"truncate max-w-[200px] sm:max-w-xs",children:o.name})]}),(0,t.jsx)("button",{onClick:()=>{x(!1),f(null)},className:"text-white/70 hover:text-white transition p-1","aria-label":"Close",children:(0,t.jsx)("span",{className:"text-2xl font-light",children:"×"})})]}),(0,t.jsx)("div",{className:"aspect-video bg-black/50 flex items-center justify-center flex-grow relative",children:h?(0,t.jsxs)("div",{className:"w-full h-full flex flex-col",children:[(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-black",children:(0,t.jsxs)("div",{className:"text-center p-4",children:[(0,t.jsx)(r.Video,{className:"w-12 h-12 text-white/30 mx-auto mb-3"}),(0,t.jsx)("p",{className:"text-white/50 font-semibold",children:"Live Stream Player"}),(0,t.jsx)("p",{className:"text-white/30 text-sm mt-2",children:h.hls_url||h.rtsp_url}),(0,t.jsxs)("div",{className:"mt-4 text-xs text-white/40 space-y-1",children:[(0,t.jsx)("p",{children:o.ip_address}),(0,t.jsx)("p",{children:o.username})]})]})}),(0,t.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-black/70 p-2 text-white/80 text-xs",children:(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,t.jsxs)("span",{className:"bg-blue-500/20 px-2 py-1 rounded",children:["HLS: ",h.hls_url?"Available":"Not configured"]}),(0,t.jsxs)("span",{className:"bg-green-500/20 px-2 py-1 rounded",children:["RTSP: ",h.rtsp_url?"Available":"Not configured"]}),(0,t.jsx)("span",{className:"bg-purple-500/20 px-2 py-1 rounded",children:h.note||"Ready"})]})})]}):(0,t.jsxs)("div",{className:"text-center p-4",children:[(0,t.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500 mb-3"}),(0,t.jsx)("p",{className:"text-white/50 font-semibold",children:"Loading stream..."})]})})]})})]})}e.s(["default",()=>o])},52169,e=>{e.v(t=>Promise.all(["static/chunks/9e166b76034126ad.js"].map(t=>e.l(t))).then(()=>t(94970)))}]);